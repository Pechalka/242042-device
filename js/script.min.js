function toJSON(e){for(var t={},n=e.querySelectorAll("input, select, textarea"),r=0;r<n.length;++r){var o=n[r],i=o.name,u=o.value;i&&(t[i]=u)}return t}function getCoords(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}var Popup=function(e){var t=e.buttonSelector,n=e.modalSelector,r=e.openedClass||"modal--open",o=e.closeSelector||".modal__close",i=e.onClose||function(){},u=document.querySelector(t),a=document.querySelector(n);if(a&&u){var c=a.querySelector(o);u.addEventListener("click",function(e){e.preventDefault(),a.classList.add(r)}),c.addEventListener("click",function(e){e.preventDefault(),a.classList.remove(r),i(a)}),window.addEventListener("keydown",function(e){27===e.keyCode&&a.classList.contains(r)&&(a.classList.remove(r),i(a))}),this.popup=a}},clearErrorsOnFocus=function(e,t){for(var n=e.querySelectorAll("input, select, textarea"),r=0;r<n.length;++r)!function(e){var r=n[e];r.name,r.value;r.addEventListener("focus",function(){r.classList.remove(t)}),r.addEventListener("keydown",function(){r.classList.remove(t)})}(r)},Form=function(e){var t=e.formSelector,n=e.errorClass||"input-error",r=document.querySelector(t);if(r){var o=(Object.keys(e.fields||{}),e.validate||function(){return{}}),i=e.onSumbit||function(){},u=e.onError||function(){};clearErrorsOnFocus(r,n);var a=function(e){var t=o(e);if(0===Object.keys(t).length)return!0;var i=!0;for(var a in t){var c=t[a];if(c){var l=r.querySelector("[name="+a+"]");i&&(l.focus(),l.classList.add(n),i=!1)}}return u(t),!1};r.addEventListener("submit",function(e){e.preventDefault();var t=e.target,n=toJSON(t);a(n)&&i(n,t)});var c=function(){for(var e=r.querySelectorAll("input, select, textarea"),t=0;t<e.length;++t)!function(t){var r=e[t];r.classList.remove(n)}(t)};this.clean=function(){r.reset(),c()},this.form=r}},drawThumb=function(e,t){e.style.left=t+"px"},dragAndDrop=function(e,t,n,r,o,i){e.onmousedown=function(u){var a=getCoords(e),c=u.pageX-a.left,l=getCoords(t);return document.onmousemove=function(n){var u=n.pageX-c-l.left;u<o()&&(u=o()),i&&u>i()&&(u=i());var a=t.offsetWidth-e.offsetWidth;u>a&&(u=a),r(u)},document.onmouseup=function(){document.onmousemove=document.onmouseup=null,n(parseInt(e.style.left))},!1},e.ondragstart=function(){return!1},e.onclick=function(){return!1}},drowLine=function(e,t,n,r){e.style.left=t+"px",e.style.right=r-n+"px"},Slider=function(e){var t=e.sliderSelecor,n=e.thumbLeftSelector,r=e.thumbRightSelector,o=e.lineSelector,i=document.querySelector(t);if(i){var u=i.querySelector(n),a=i.querySelector(r),c=i.querySelector(o),l=e.onChange||function(){},s=u.getBoundingClientRect().width,f=i.getBoundingClientRect().width,d=e.maxPrice,m=function(e){return+(e/(f-s)*d).toFixed(0)},v=function(e){return+(e/d*(f-s)).toFixed(0)},p=v(e.initMin),g=v(e.initMax);drawThumb(u,p),drawThumb(a,g),drowLine(c,p,g,f),l(m(p),m(g),p,g),dragAndDrop(u,i,function(e){p=e,l(m(p),m(g),p,g)},function(e){drowLine(c,e,g,f),drawThumb(u,e)},function(){return 0},function(){return parseInt(a.style.left)-s}),dragAndDrop(a,i,function(e){g=e,l(m(p),m(g),p,g)},function(e){drowLine(c,p,e,f),drawThumb(a,e)},function(){return parseInt(u.style.left)+s})}};window.onload=function(){var e=new Form({formSelector:".js-write-us-modal form",onError:function(){var e=t.popup;e.classList.remove("modal--error"),e.offsetWidth=e.offsetWidth,e.classList.add("modal--error")},validate:function(e){return e.name?e.email?e.message?{}:{message:"Введите сообщение"}:{email:"Введите email"}:{name:"Введите имя"}},onSumbit:function(e){console.log(" save form ",e)}});Popup({buttonSelector:".js-map",modalSelector:".js-map-modal"});var t=new Popup({buttonSelector:".js-write-us",modalSelector:".js-write-us-modal",onClose:function(t){t.classList.remove("modal--error"),e.clean()}}),n=document.querySelector(".range_left__value"),r=document.querySelector(".range_right__value"),o=document.querySelector("[name=min_price]"),i=document.querySelector("[name=max_price]");Slider({sliderSelecor:".range",thumbLeftSelector:".range_left",thumbRightSelector:".range_right",lineSelector:".range_field",initMin:0,initMax:5e3,maxPrice:1e4,onChange:function(e,t,u,a){console.log(e,t,u,a),n.innerHTML="от "+e,r.innerHTML="до "+t,o.value=e,i.value=t}})};
